extends ../layout/main

block content
  - const photo = athlete.photo_url || null;
  - const eff = Number(effectiveness || 0).toFixed(1);
  - const isSubadmin = currentUser && (currentUser.role === 'subadmin' || currentUser.role === 'admin');
  - const mp = (stats && stats.match_played) ? stats.match_played : 0;
  - const mw = (stats && stats.match_won) ? stats.match_won : 0;
  - const ml = (stats && stats.match_lost) ? stats.match_lost : 0;
  - const winRate = stats && stats.match_played > 0 ? ((stats.match_won / stats.match_played) * 100).toFixed(1) : 0;
  
  style.
    .athlete-page { 
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
      min-height: 100vh; 
      padding: 0; 
    }
    
    /* Header Section - SEJAJAR */
    .header-section {
      background: linear-gradient(135deg, #0B1F3F 0%, #1a3a5c 100%);
      padding: 3rem 0;
      position: relative;
      overflow: hidden;
    }
    .header-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(0, 149, 255, 0.15) 0%, transparent 70%);
      border-radius: 50%;
    }
    
    /* Header Content Grid - SEJAJAR */
    .header-grid {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 2rem;
      align-items: center;
      position: relative;
      z-index: 2;
    }
    
    /* Rank Badge */
    .rank-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
      position: relative;
      flex-shrink: 0;
    }
    .rank-badge::before {
      content: 'RANK';
      position: absolute;
      top: 8px;
      font-size: 0.65rem;
      font-weight: 700;
      color: #0B1F3F;
      letter-spacing: 1px;
    }
    .rank-number {
      font-family: 'Bebas Neue', cursive;
      font-size: 3rem;
      line-height: 1;
      color: #0B1F3F;
      font-weight: 900;
      margin-top: 15px;
    }
    
    /* Avatar - SEJAJAR */
    .athlete-avatar {
      width: 200px;
      height: 200px;
      border-radius: 20px;
      object-fit: cover;
      border: 4px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    }
    .avatar-placeholder {
      width: 200px;
      height: 200px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border: 4px solid rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Center Content - SEJAJAR */
    .center-content {
      padding: 0 1.5rem;
    }
    .athlete-name {
      font-weight: 900;
      font-size: 2.5rem;
      margin: 0 0 1rem 0;
      color: #fff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
      line-height: 1.2;
    }
    
    /* Meta Badges */
    .meta-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    .meta-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      font-size: 0.9rem;
      font-weight: 600;
      color: #fff;
      transition: all 0.3s ease;
    }
    .meta-badge:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }
    .meta-badge i {
      font-size: 1.1rem;
    }
    
    /* Quick Stats - SEJAJAR */
    .quick-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1rem;
    }
    .quick-stat-card {
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 1.25rem;
      transition: all 0.3s ease;
    }
    .quick-stat-card:hover {
      background: rgba(255, 255, 255, 0.18);
      transform: translateY(-2px);
    }
    .quick-stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #fff;
    }
    .quick-stat-row:not(:last-child) {
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .quick-stat-label {
      font-size: 0.85rem;
      opacity: 0.85;
      font-weight: 500;
      white-space: nowrap;
    }
    .quick-stat-value {
      font-weight: 700;
      font-size: 1rem;
      text-align: right;
      min-width: 80px;
    }
    
    /* Edit Button */
    .btn-edit-athlete {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      font-weight: 600;
      padding: 0.5rem 1.25rem;
      border-radius: 10px;
      transition: all 0.3s ease;
      margin-top: 1rem;
    }
    .btn-edit-athlete:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.4);
      color: #fff;
      transform: translateY(-2px);
    }
    
    /* Stats Grid - SEJAJAR */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin: 2rem auto 0;
      max-width: 1200px;
      padding: 0 1.5rem;
    }
    .stat-card {
      background: #fff;
      border-radius: 20px;
      padding: 2rem 1.5rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      border: 1px solid #f0f0f0;
      transition: all 0.3s ease;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #0B1F3F, #0095ff);
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.12);
    }
    .stat-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #0B1F3F 0%, #1a3a5c 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      color: #fff;
      font-size: 1.5rem;
    }
    .stat-label {
      color: #6c757d;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }
    .stat-value {
      font-weight: 900;
      font-size: 2.2rem;
      color: #0B1F3F;
      line-height: 1;
      margin-bottom: 0.25rem;
    }
    .stat-subtext {
      font-size: 0.75rem;
      color: #6c757d;
      margin-top: 0.5rem;
      font-weight: 500;
    }
    
    /* Content Grid - SEJAJAR */
    .content-container {
      max-width: 1200px;
      margin: 3rem auto 5rem;
      padding: 0 1.5rem;
    }
    .content-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
    }
    .content-card {
      background: #fff;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      border: 1px solid #f0f0f0;
      transition: all 0.3s ease;
      height: 100%;
    }
    .content-card:hover {
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.12);
    }
    .card-header-custom {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #f0f0f0;
    }
    .card-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #0B1F3F 0%, #1a3a5c 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 1.3rem;
    }
    .card-title {
      font-weight: 800;
      font-size: 1.5rem;
      color: #0B1F3F;
      margin: 0;
    }
    
    /* Bio Section */
    .bio-text {
      font-size: 1rem;
      line-height: 1.8;
      color: #495057;
      margin-bottom: 0;
    }
    
    /* Info Badges */
    .info-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.4rem 1rem;
      border-radius: 10px;
      background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
      border: 1px solid #dee2e6;
      font-weight: 600;
      font-size: 0.9rem;
      color: #495057;
    }
    .info-badge i {
      margin-right: 0.5rem;
      color: #0B1F3F;
    }
    
    /* Points History Card */
    .points-history-card {
      grid-column: span 2;
      margin-top: 1rem;
    }
    
    /* Table Styling */
    .custom-table {
      width: 100%;
      margin: 0;
      border-collapse: separate;
      border-spacing: 0;
    }
    .custom-table thead th {
      background: linear-gradient(135deg, #0B1F3F 0%, #1a3a5c 100%);
      color: #fff;
      border: none;
      padding: 1rem 1rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 700;
      white-space: nowrap;
      text-align: left;
    }
    .custom-table thead th:first-child {
      border-top-left-radius: 12px;
    }
    .custom-table thead th:last-child {
      border-top-right-radius: 12px;
    }
    .custom-table tbody td {
      padding: 1rem 1rem;
      border-bottom: 1px solid #f0f0f0;
      vertical-align: middle;
      color: #495057;
      font-size: 0.9rem;
    }
    .custom-table tbody tr:hover {
      background: #f8f9fa;
    }
    .custom-table tbody tr:last-child td {
      border-bottom: none;
    }
    
    /* Modal */
    .modal-content-fixed {
      border-radius: 20px;
      border: none;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
    }
    .modal-body-scrollable {
      padding: 2rem;
      overflow-y: auto;
      flex: 1 1 auto;
      max-height: calc(85vh - 180px);
    }
    .modal-footer-sticky {
      padding: 1.5rem 2rem;
      background: #f8f9fa;
      border-top: 2px solid #dee2e6;
      flex-shrink: 0;
      position: sticky;
      bottom: 0;
      z-index: 10;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
      .header-grid {
        grid-template-columns: auto 1fr;
      }
      .header-grid .avatar-container {
        grid-column: span 2;
        justify-self: center;
        margin-top: 2rem;
      }
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 992px) {
      .header-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      .rank-badge {
        margin: 0 auto;
      }
      .center-content {
        text-align: center;
        padding: 0;
      }
      .meta-badges {
        justify-content: center;
      }
      .header-grid .avatar-container {
        grid-column: auto;
        margin-top: 0;
      }
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      .content-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      .points-history-card {
        grid-column: span 1;
      }
    }
    
    @media (max-width: 768px) {
      .header-section {
        padding: 2rem 0;
      }
      .athlete-name {
        font-size: 2rem;
      }
      .athlete-avatar, .avatar-placeholder {
        width: 150px;
        height: 150px;
      }
      .rank-badge {
        width: 80px;
        height: 80px;
      }
      .rank-number {
        font-size: 2.2rem;
      }
      .quick-stats-grid {
        grid-template-columns: 1fr;
      }
      .stats-grid {
        grid-template-columns: 1fr;
        padding: 0 1rem;
      }
      .stat-card {
        padding: 1.5rem;
      }
      .stat-value {
        font-size: 1.8rem;
      }
    }
    
    @media (max-width: 576px) {
      .athlete-name {
        font-size: 1.8rem;
      }
      .content-card {
        padding: 1.5rem;
      }
      .card-title {
        font-size: 1.3rem;
      }
      .meta-badge {
        font-size: 0.85rem;
        padding: 0.4rem 0.8rem;
      }
    }

  .athlete-page
    //- Header Section - SEJAJAR
    .header-section
      .container
        .header-grid
          //- Rank Badge (Kiri)
          .rank-container
            .rank-badge
              .rank-number #{rank || '-'}
          
          //- Center Content (Tengah)
          .center-content
            h1.athlete-name= athlete.name
            
            .meta-badges
              .meta-badge
                i.bi.bi-flag-fill
                span= athlete.country_code || 'N/A'
              .meta-badge
                i.bi.bi-trophy-fill
                span #{athlete.points || 0} Points
              if athlete.playing_position
                .meta-badge
                  i.bi.bi-diagram-3-fill
                  span= athlete.playing_position
              if athlete.paired_with_name
                .meta-badge
                  i.bi.bi-people-fill
                  span
                    | Partner: 
                    if athlete.paired_with_slug
                      a.text-white.text-decoration-underline(href=`/athletes/${athlete.paired_with_slug}`)= athlete.paired_with_name
                    else
                      | #{athlete.paired_with_name}
            
            .quick-stats-grid
              .quick-stat-card
                .quick-stat-row
                  span.quick-stat-label
                    i.bi.bi-calendar3.me-2
                    | Born
                  span.quick-stat-value= athlete.born_in || '-'
                .quick-stat-row
                  span.quick-stat-label
                    i.bi.bi-person-badge.me-2
                    | Coach
                  span.quick-stat-value= athlete.coach || '-'
              
              .quick-stat-card
                .quick-stat-row
                  span.quick-stat-label
                    i.bi.bi-rulers.me-2
                    | Height
                  span.quick-stat-value= athlete.height_cm ? `${athlete.height_cm} cm` : '-'
                .quick-stat-row
                  span.quick-stat-label
                    i.bi.bi-star-fill.me-2
                    | Best Rank
                  span.quick-stat-value= athlete.best_rank || '-'
            
            if isSubadmin
              button.btn.btn-edit-athlete(
                type="button"
                data-bs-toggle="modal"
                data-bs-target="#editAthleteModal"
              )
                i.bi.bi-pencil-square.me-2
                | Edit Profile
          
          //- Avatar (Kanan)
          .avatar-container
            if photo
              img.athlete-avatar(src=photo, alt=athlete.name)
            else
              .avatar-placeholder
                i.bi.bi-person-circle(style='font-size: 5rem; opacity: 0.5; color: rgba(255,255,255,0.6);')
    
    //- Stats Grid - SEJAJAR
    .container
      .stats-grid
        .stat-card
          .stat-icon
            i.bi.bi-controller
          .stat-label Matches Played
          .stat-value= stats.match_played || 0
        
        .stat-card
          .stat-icon
            i.bi.bi-trophy-fill
          .stat-label Matches Won
          .stat-value= stats.match_won || 0
          .stat-subtext Win Rate: #{winRate}%
        
        .stat-card
          .stat-icon
            i.bi.bi-x-circle
          .stat-label Matches Lost
          .stat-value= stats.match_lost || 0
        
        .stat-card
          .stat-icon
            i.bi.bi-graph-up-arrow
          .stat-label Effectiveness
          .stat-value #{eff}%
    
    //- Content Section - SEJAJAR
    .content-container
      .content-grid
        //- Player Profile Card
        .content-card
          .card-header-custom
            .card-icon
              i.bi.bi-person-lines-fill
            h2.card-title Player Profile
          
          if athlete.bio
            p.bio-text= athlete.bio
          else
            p.bio-text.text-muted.fst-italic No biography available yet.
          
          hr.my-4
          
          .d-flex.flex-wrap.gap-2
            .info-badge
              i.bi.bi-trophy
              span #{athlete.titles || 0} Titles
            .info-badge
              i.bi.bi-award
              span #{athlete.race || 'N/A'}
        
        //- Points Breakdown Card
        .content-card
          .card-header-custom
            .card-icon
              i.bi.bi-bar-chart-fill
            h2.card-title Points Breakdown
          
          if pointsByTournament && pointsByTournament.length
            .table-responsive
              table.custom-table
                thead
                  tr
                    th Tournament
                    th Category
                    th.text-center Total Points
                    th.text-center Last Event
                tbody
                  each r in pointsByTournament
                    tr
                      td
                        strong= r.tournament
                      td
                        span.badge.bg-light.text-dark= r.category || '-'
                      td.text-center
                        span.fw-bold.text-primary= r.total_points
                      td.text-center.text-muted.small
                        = r.last_event ? new Date(r.last_event).toLocaleDateString('id-ID') : '-'
          else
            p.text-muted.mb-0.fst-italic No tournament points data available.
      
      //- Points History Card
      .content-card.points-history-card
        .card-header-custom
          .card-icon
            i.bi.bi-clock-history
          h2.card-title Points History
        
        if pointsBreakdown && pointsBreakdown.length
          .table-responsive
            table.custom-table
              thead
                tr
                  th Date
                  th Tournament
                  th Category
                  th Round
                  th.text-center Points
              tbody
                each r in pointsBreakdown
                  tr
                    td.small.text-muted
                      i.bi.bi-calendar-event.me-2
                      = r.event_date ? new Date(r.event_date).toLocaleDateString('id-ID') : '-'
                    td
                      strong= r.tournament
                    td
                      span.badge.bg-light.text-dark= r.category || '-'
                    td= r.round_name || '-'
                    td.text-center
                      span.badge.bg-primary.px-3.py-2= r.points
        else
          p.text-muted.mb-0.fst-italic No points history available.

    //- Edit Modal
    if isSubadmin
      .modal.fade#editAthleteModal(tabindex="-1" aria-hidden="true")
        .modal-dialog.modal-lg
          .modal-content.modal-content-fixed
            form(method="POST" action=`/subadmin/athletes/${athlete.id}` enctype="multipart/form-data" style="display: flex; flex-direction: column; height: 100%;")
              .modal-header(style="background: linear-gradient(135deg, #0B1F3F 0%, #1a3a5c 100%); color: #fff; border-radius: 20px 20px 0 0; flex-shrink: 0;")
                h5.modal-title
                  i.bi.bi-pencil-square.me-2
                  | Edit Athlete Profile
                button.btn-close.btn-close-white(type="button" data-bs-dismiss="modal" aria-label="Close")
              
              .modal-body.modal-body-scrollable
                .row.g-3
                  .col-md-6
                    label.form-label.fw-semibold Name *
                    input.form-control(type="text" name="name" required value=athlete.name style="border-radius: 10px;")
                  .col-md-6
                    label.form-label.fw-semibold Country Code
                    input.form-control(type="text" name="country_code" value=(athlete.country_code || '') placeholder="ID / US / ..." style="border-radius: 10px;")

                  .col-md-6
                    label.form-label.fw-semibold Position
                    input.form-control(type="text" name="playing_position" value=(athlete.playing_position || '') style="border-radius: 10px;")
                  .col-md-6
                    label.form-label.fw-semibold Coach
                    input.form-control(type="text" name="coach" value=(athlete.coach || '') style="border-radius: 10px;")

                  .col-md-6
                    label.form-label.fw-semibold Born in
                    input.form-control(type="text" name="born_in" value=(athlete.born_in || '') style="border-radius: 10px;")
                  .col-md-6
                    label.form-label.fw-semibold Height (cm)
                    input.form-control(type="number" name="height_cm" min="0" value=(athlete.height_cm || '') style="border-radius: 10px;")

                  .col-md-12
                    label.form-label.fw-semibold Biography
                    textarea.form-control(name="bio" rows="4" style="border-radius: 10px;")= athlete.bio || ''

                  .col-md-6
                    label.form-label.fw-semibold Titles
                    input.form-control(type="number" name="titles" min="0" value=(athlete.titles || 0) style="border-radius: 10px;")
                  .col-md-6
                    label.form-label.fw-semibold Race
                    input.form-control(type="text" name="race" value=(athlete.race || '') style="border-radius: 10px;")

                  .col-md-12
                    label.form-label.fw-semibold Athlete Photo
                    input.form-control(type="file" name="photo" accept="image/*" style="border-radius: 10px;")
                    if athlete.photo_url
                      small.text-muted.d-block.mt-2
                        i.bi.bi-image.me-1
                        | Current photo: #{athlete.photo_url}

              .modal-footer.modal-footer-sticky
                button.btn.btn-secondary(type="button" data-bs-dismiss="modal" style="border-radius: 10px; padding: 0.6rem 1.5rem;") Cancel
                button.btn.btn-primary(type="submit" style="border-radius: 10px; padding: 0.6rem 1.5rem; background: linear-gradient(135deg, #0B1F3F 0%, #1a3a5c 100%); border: none;")
                  i.bi.bi-check-circle.me-2
                  | Save Changes